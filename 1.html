<!DOCTYPE html>
<html>
<style>
.mydivChild {
  margin-bottom: 10px; 
  cursor: move;
  background-color:grey;
  width: 300px;
  height: 30px;
  text-align: center;
}
#parent {
  height: 1000px;
  position: relative;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<body>

<h1>Draggable DIV Element</h1>

<p>Click and hold the mouse button down while moving the DIV element</p>

<div id="parent">
  	<div class="mydiv">
      <div class="mydivChild">1</div>
    </div>
  	<div class="mydiv">
      <div class="mydivChild">2</div>
    </div>
    <div class="mydiv">
      <div class="mydivChild">3</div>
    </div>
    <div class="mydiv">
      <div class="mydivChild">4</div>
    </div>
    <div class="mydiv">
      <div class="mydivChild">5</div>
    </div>
    <div class="mydiv">
      <div class="mydivChild">6</div>
    </div>
    <div class="mydiv">
      <div class="mydivChild">7</div>
    </div>
    <div class="mydiv">
      <div class="mydivChild">8</div>
    </div>
</div>
<div id="vertualContent"></div>

<script>

var virtualDiv = document.getElementById("virtualDiv");
var allDivs =  document.getElementsByClassName("mydiv");
var divNum = allDivs.length;
var index;
var previewBoxHeight = 30;

for( i = 0; i < divNum; i++ ){
    allDivs[i].classList.add(i);
}

// Get the parent element
var parent = document.getElementById('parent');
// Attach event listener to the parent
parent.addEventListener('mousedown', function(event) {
  // Get the clicked element
  var clickedElement = event.target;
  // Find the index of the clicked element among its siblings
  var children = Array.from(parent.children);
  index = children.indexOf(clickedElement.parentElement);
  var draggingDiv = document.getElementsByClassName(index)[0];
  
  var selectRect = draggingDiv.getBoundingClientRect();
	var selectElementOriginPosX = selectRect.left - 8; 
  
  if (selectElementOriginPosX == 40) {
    var i = index + 1;
    var groupParentElement = document.getElementsByClassName(i)[0];
    var childElement = groupParentElement.querySelector('.mydivChild');
    groupRect = groupParentElement.getBoundingClientRect();
    groupElementOriginPosX = groupRect.left - 8; 
    while (groupElementOriginPosX !== 0){
      $(draggingDiv).append(childElement);
      childElement.style.marginLeft = (groupElementOriginPosX - 40) + "px"
      previewBoxHeight += 40;
      i++;
      groupParentElement = document.getElementsByClassName(i)[0];
      childElement = groupParentElement.querySelector('.mydivChild');
      groupRect = groupParentElement.getBoundingClientRect();
      groupElementOriginPosX = groupRect.left - 8;
    } 
  }
  dragElement(draggingDiv);

});

//Make the DIV element draggagle:
function dragElement(element) {

  var draggingX, draggingY, movingMousePosX, movingMousePosY;
  var dragEndPosX, dragEndPosY;
  var elementOriginPosX, elementOriginPosY, elementMovingPosY, elementMovingPosX, upperElementPosX, upperElementPosY, 
      lowerElementPosX, lowerElementPosY; 
  var mouseOriginPosX, mouseOriginPosY; 
  var stepX = 0, stepY = 40;
  var prependIndex, appendIndex, upperIndex, lowerIndex;
  var prependDiv, appendDiv, upperDiv, lowerDiv;

  // start the drag funtionality
  element.onmousedown = dragMouseDown;

  function dragMouseDown(e) {

    e = e || window.event;
    e.preventDefault();
    element.style.position = "absolute"
    element.style.marginLeft = "0px";
    // get the original position of element:
    var rect = element.getBoundingClientRect();
	  elementOriginPosY = rect.top - 113.875; 
	  elementOriginPosX = rect.left - 8; 

    // get the mouse cursor position at startup:
   	mouseOriginPosX = e.clientX; 
    mouseOriginPosY = e.clientY; 
    movingMousePosX = e.clientX;
    movingMousePosY = e.clientY;

    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    draggingX = movingMousePosX - e.clientX;
    draggingY = movingMousePosY - e.clientY;
    movingMousePosX = e.clientX;
    movingMousePosY = e.clientY;

    // set the element's new position during mousemoving:
    element.style.top = (element.offsetTop - draggingY) + "px";
    element.style.left = (element.offsetLeft - draggingX) + "px";
    elementMovingPosY = element.offsetTop - draggingY;
    elementMovingPosX = element.offsetLeft - draggingX;
    // set the element's new position by step at the end of dragging:
   

    // create preview box:
    var previewDiv = document.createElement("div");
    previewDiv.style.borderStyle = "dotted";
    previewDiv.style.borderWidth = "1px";
    previewDiv.style.borderColor = "black";
    previewDiv.style.width = "200px";
    previewDiv.style.height = previewBoxHeight + "px";
    previewDiv.style.marginBottom = "10px";
    previewDiv.id = "previewDiv";
    
    // set the element's new position by step at the end of dragging:
     // set preview box pos when vertical dragging
    if (e.clientY < mouseOriginPosY - 10 ) {
        $("#previewDiv").remove();
        prependIndex = parseInt((elementMovingPosY + 10) / 40);
        if(index == 0) {prependIndex = 1}
        if(prependIndex < 0) {prependIndex = 0}
        prependDiv =  document.getElementsByClassName(prependIndex)[0];
        $(prependDiv).before(previewDiv);
        
    } else if (e.clientY > mouseOriginPosY + 10) {
        $("#previewDiv").remove();
        prependIndex = parseInt((elementMovingPosY + 30) / 40);
        if(index < 7) {
          if(prependIndex < 7) {
            prependDiv =  document.getElementsByClassName(prependIndex)[0];
            $(prependDiv).before(previewDiv);
          } else {
            if(elementMovingPosY < 295) {
              prependIndex = 7;
              prependDiv =  document.getElementsByClassName(prependIndex)[0];
              $(prependDiv).before(previewDiv);
            } else {
              appendIndex = 7;
              appendDiv = document.getElementsByClassName(appendIndex)[0];
              $(appendDiv).after(previewDiv);
            }
          }
        } else {
          if(prependIndex < 7) {
            prependDiv =  document.getElementsByClassName(prependIndex)[0];
            $(prependDiv).before(previewDiv);
          } else {
            appendIndex = 6;
            appendDiv =  document.getElementsByClassName(appendIndex)[0];
            $(appendDiv).after(previewDiv);
          }
        }
        if(prependIndex > 6) {
          appendIndex = 6;
          appendDiv =  document.getElementsByClassName(appendIndex)[0];
        } else {
            $(prependDiv).before(previewDiv);
            $("#previewDiv").remove();
            $(prependDiv).after(previewDiv);
          
        }
    } else if (e.clientY <= mouseOriginPosY + 10 && e.clientY >= mouseOriginPosY - 10) {
      $("#previewDiv").remove();
      prependIndex = index + 1;
      appendIndex = index - 1;
      if(prependIndex < 7) {
        prependDiv =  document.getElementsByClassName(prependIndex)[0];
        $(prependDiv).before(previewDiv);
      } else {
        appendDiv =  document.getElementsByClassName(appendIndex)[0];
        $(appendDiv).after(previewDiv);
      }
    }
     // set preview box pos when horizontal dragging
    if (elementOriginPosX > 0) {
      if(parseInt(element.style.left) == 40) {
        if(elementMovingPosX < 30) {
          previewDiv.style.marginLeft = "0px";
        } else {
          previewDiv.style.marginLeft = "40px";
        }
      } else {
        if (e.clientY < mouseOriginPosY - 10 ) {
          previewDiv.style.marginLeft = elementOriginPosX - 40 + "px";
          lowerIndex = parseInt((elementMovingPosY + 30) / 40);
          lowerDiv = document.getElementsByClassName(lowerIndex)[0];
          if(lowerDiv == undefined || isNaN(parseInt(lowerDiv.style.marginLeft))) {
            if(elementMovingPosX < 30) {
              previewDiv.style.marginLeft = "0px";
            } else {
              previewDiv.style.marginLeft = "40px";
            }
          } else {
            previewDiv.style.marginLeft = parseInt(lowerDiv.style.marginLeft) + "px";
            lowerDiv.style.marginLeft = elementOriginPosX;
          }
        } else if (e.clientY > mouseOriginPosY + 10) {
          upperIndex = parseInt((elementMovingPosY + 10) / 40);
          upperDiv =  document.getElementsByClassName(upperIndex)[0];
          if(upperDiv == undefined || isNaN(parseInt(upperDiv.style.marginLeft))) {
            if(elementMovingPosX < 30) {
              previewDiv.style.marginLeft = "0px";
            } else {
              previewDiv.style.marginLeft = "40px";
            }
          } else {
            previewDiv.style.marginLeft = parseInt(upperDiv.style.marginLeft) + "px";
          }
        } else {
          if(e.clientX > mouseOriginPosX + 10) {
            previewDiv.style.marginLeft = elementOriginPosX + "px";
          } else {
            previewDiv.style.marginLeft = "0px";
          }
        }
      }
    } else {
      if(e.clientX > mouseOriginPosX + 10) {
        if (e.clientY < mouseOriginPosY - 10 ) { 
            upperIndex = parseInt((elementMovingPosY + 10) / 40);
            upperDiv =  document.getElementsByClassName(upperIndex-1)[0];
            if(upperDiv == undefined || isNaN(parseInt(upperDiv.style.marginLeft))) {
              previewDiv.style.marginLeft = "40px"
            } else {
              previewDiv.style.marginLeft = 40 + parseInt(upperDiv.style.marginLeft) + "px"
            }
        } else if(e.clientY > mouseOriginPosY + 10) {
            lowerIndex = parseInt((elementMovingPosY + 30) / 40);
            lowerDiv = document.getElementsByClassName(lowerIndex)[0];
            if(lowerDiv == undefined || isNaN(parseInt(lowerDiv.style.marginLeft))) {
              previewDiv.style.marginLeft = "40px";
            } else {
              previewDiv.style.marginLeft = 40 + parseInt(lowerDiv.style.marginLeft) + "px"
            }
        } else {
          upperIndex = index;
          upperDiv =  document.getElementsByClassName(upperIndex-1)[0]; 
          if(upperDiv == undefined || isNaN(parseInt(upperDiv.style.marginLeft))) {
              previewDiv.style.marginLeft = "40px"
          } else {
              previewDiv.style.marginLeft = 40 + parseInt(upperDiv.style.marginLeft) + "px";
          }
        }
      } else {
        previewDiv.style.marginLeft = "0px";
      }
    } 
  }

  function closeDragElement(e) {
    e = e || window.event;
    e.preventDefault();

    $("#previewDiv").remove();
    element.style.position = "static";
    if (e.clientY < mouseOriginPosY - 10 ) {
        prependIndex = parseInt((elementMovingPosY + 10) / 40);
        if(prependIndex < 0) {prependIndex = 0}
        prependDiv =  document.getElementsByClassName(prependIndex)[0];
        $(prependDiv).before(element);
        
    } else if (e.clientY > mouseOriginPosY + 10) {
        prependIndex = parseInt((elementMovingPosY + 30) / 40);
        if(prependIndex > 7) {prependIndex = 7}
        prependDiv =  document.getElementsByClassName(prependIndex)[0];
        if(mouseOriginPosY <= 295){
          $(prependDiv).before(element);
        }
        if(elementMovingPosY > 295) {
          $(prependDiv).after(element);
        }
    } else if (e.clientY <= mouseOriginPosY + 10 && e.clientY >= mouseOriginPosY - 10) {
        prependIndex = index + 1;
        appendIndex = index - 1;
        if(prependIndex < 7) {
          prependDiv =  document.getElementsByClassName(prependIndex)[0];
          $(prependDiv).before(element);
        } else {
          appendDiv =  document.getElementsByClassName(appendIndex)[0];
          $(appendDiv).after(element);
        }
    }

    if (elementOriginPosX > 0) {
      if(parseInt(element.style.left) == 40) {
        if(elementMovingPosX < 30) {
          element.style.marginLeft = "0px";
        } else {
          element.style.marginLeft = "40px";
        }
      } else {
        if (e.clientY < mouseOriginPosY - 10 ) {
          element.style.marginLeft = elementOriginPosX - 40 + "px";
          lowerIndex = parseInt((elementMovingPosY + 30) / 40);
          lowerDiv = document.getElementsByClassName(lowerIndex)[0];
          if(lowerDiv == undefined || isNaN(parseInt(lowerDiv.style.marginLeft))) {
            if(elementMovingPosX < 30) {
              element.style.marginLeft = "0px";
            } else {
              element.style.marginLeft = "40px";
            }
          } else {
            element.style.marginLeft = parseInt(lowerDiv.style.marginLeft) + "px";
            lowerDiv.style.marginLeft = elementOriginPosX;
          }
        } else if (e.clientY > mouseOriginPosY + 10) {
          upperIndex = parseInt((elementMovingPosY + 10) / 40);
          upperDiv =  document.getElementsByClassName(upperIndex)[0];
          if(upperDiv == undefined || isNaN(parseInt(upperDiv.style.marginLeft))) {
            if(elementMovingPosX < 30) {
              element.style.marginLeft = "0px";
            } else {
              element.style.marginLeft = "40px";
            }
          } else {
            element.style.marginLeft = parseInt(upperDiv.style.marginLeft) + "px";
          }
        } else {
          if(e.clientX > mouseOriginPosX + 10) {
            element.style.marginLeft = elementOriginPosX + "px";
          } else {
            element.style.marginLeft = "0px";
          }
        }
      }
    } else {
      if(e.clientX > mouseOriginPosX + 10) {
        if (e.clientY < mouseOriginPosY - 10 ) { 
            upperIndex = parseInt((elementMovingPosY + 10) / 40);
            upperDiv =  document.getElementsByClassName(upperIndex-1)[0];
            if(upperDiv == undefined || isNaN(parseInt(upperDiv.style.marginLeft))) {
              element.style.marginLeft = "40px"
            } else {
              element.style.marginLeft = 40 + parseInt(upperDiv.style.marginLeft) + "px"
            }
        } else if(e.clientY > mouseOriginPosY + 10) {
            lowerIndex = parseInt((elementMovingPosY + 30) / 40);
            lowerDiv = document.getElementsByClassName(lowerIndex)[0];
            if(lowerDiv == undefined || isNaN(parseInt(lowerDiv.style.marginLeft))) {
              element.style.marginLeft = "40px";
            } else {
              element.style.marginLeft = 40 + parseInt(lowerDiv.style.marginLeft) + "px"
            }
        } else {
          upperIndex = index;
          upperDiv =  document.getElementsByClassName(upperIndex-1)[0]; 
          if(upperDiv == undefined || isNaN(parseInt(upperDiv.style.marginLeft))) {
              element.style.marginLeft = "40px"
          } else {
              element.style.marginLeft = 40 + parseInt(upperDiv.style.marginLeft) + "px"
          }
        }
      } else {
        element.style.marginLeft = "0px";
      }
    } 
    
    var rect = element.getBoundingClientRect();
	  elementEndPosY = rect.top - 113.875; 
	  elementEndPosX = rect.left - 8; 
    element.style.top = elementEndPosY + "px";
    element.style.left = elementEndPosX + "px";

    document.onmouseup = null;
    document.onmousemove = null;
    for( i = 0; i < divNum; i++ ){
    allDivs[i].className = "mydiv";
    allDivs[i].classList.add(i);
    }
  }
}
</script>

</body>
</html>
